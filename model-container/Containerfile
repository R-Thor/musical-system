FROM ubuntu:22.04

# System deps
RUN apt-get update && apt-get install -y \
    build-essential cmake git curl \
    libcurl4-openssl-dev \
    && rm -rf /var/lib/apt/lists/*

# Clone llama.cpp
RUN git clone https://github.com/ggerganov/llama.cpp /opt/llama.cpp

# Build with CMake (new build system)
RUN mkdir -p /opt/llama.cpp/build && \
    cd /opt/llama.cpp/build && \
    cmake .. && \
    cmake --build . --config Release -j

# Model directory
RUN mkdir -p /models

# Download model
RUN curl -L \
  -o /models/llama-3.2-3b-instruct.gguf \
  https://huggingface.co/.../llama-3.2-3b-instruct.gguf

VOLUME ["/models"]

WORKDIR /opt/llama.cpp
EXPOSE 8080

CMD ["bash"]
